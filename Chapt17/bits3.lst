     1                                  ; bits3.asm
     2                                  extern  printb
     3                                  extern  printf
     4                                  
     5                                  section .data
     6 00000000 4E6F20626974732073-         msg1    db  "No bits set: ",10,0
     6 00000009 65743A200A00       
     7 0000000F 0A5365742023343A20-         msg2    db  10,"Set #4: ",10,0
     7 00000018 0A00               
     8 0000001A 0A5365742023373A20-         msg3    db  10,"Set #7: ",10,0
     8 00000023 0A00               
     9 00000025 0A5365742023393A20-         msg4    db  10,"Set #9: ",10,0
     9 0000002E 0A00               
    10 00000030 0A536574202336313A-         msg5    db  10,"Set #61: ",10,0
    10 00000039 200A00             
    11 0000003C 0A436C656172202338-         msg6    db  10,"Clear #8: ",10,0
    11 00000045 3A200A00           
    12 00000049 0A5465737420233631-         msg7    db  10,"Test #61, show rdi: ",10,0
    12 00000052 2C2073686F77207264-
    12 0000005B 693A200A00         
    13 00000060 0000000000000000            bitflags    dq  0
    14                                  section .bss
    15                                  section .text
    16                                      global  main
    17                                  main:
    18 00000000 55                          push    rbp
    19 00000001 4889E5                      mov     rbp, rsp
    20                                  
    21 00000004 48BF-                       mov     rdi, msg1
    21 00000006 [0000000000000000] 
    22 0000000E 4831C0                      xor     rax, rax
    23 00000011 E8(00000000)                call    printf
    24                                  
    25 00000016 488B3C25[60000000]          mov     rdi, [bitflags]
    26 0000001E E8(00000000)                call    printb
    27                                  
    28                                      ;set bit 4
    29 00000023 48BF-                       mov     rdi, msg2
    29 00000025 [0F00000000000000] 
    30 0000002D 4831C0                      xor     rax, rax
    31 00000030 E8(00000000)                call    printf
    32                                  
    33 00000035 480FBA2C25-                 bts     qword [bitflags], 4 ; set 4th bit of bitflags
    33 0000003A [60000000]04       
    34 0000003F 488B3C25[60000000]          mov     rdi, [bitflags]
    35 00000047 E8(00000000)                call    printb
    36                                  
    37                                      ; set bit 7
    38 0000004C 48BF-                       mov     rdi, msg3
    38 0000004E [1A00000000000000] 
    39 00000056 4831C0                      xor     rax, rax
    40 00000059 E8(00000000)                call    printf
    41                                  
    42 0000005E 480FBA2C25-                 bts     qword [bitflags], 7
    42 00000063 [60000000]07       
    43 00000068 488B3C25[60000000]          mov     rdi, [bitflags]
    44 00000070 E8(00000000)                call    printb
    45                                  
    46                                      ; set bit 8
    47 00000075 48BF-                       mov     rdi, msg4
    47 00000077 [2500000000000000] 
    48 0000007F 4831C0                      xor     rax, rax
    49 00000082 E8(00000000)                call    printf
    50                                  
    51 00000087 480FBA2C25-                 bts     qword [bitflags], 8
    51 0000008C [60000000]08       
    52 00000091 488B3C25[60000000]          mov     rdi, [bitflags]
    53 00000099 E8(00000000)                call    printb
    54                                  
    55                                      ; set bit 61
    56 0000009E 48BF-                       mov     rdi, msg5
    56 000000A0 [3000000000000000] 
    57 000000A8 4831C0                      xor     rax, rax
    58 000000AB E8(00000000)                call    printf
    59                                  
    60 000000B0 480FBA2C25-                 bts     qword [bitflags], 61
    60 000000B5 [60000000]3D       
    61 000000BA 488B3C25[60000000]          mov     rdi, [bitflags]
    62 000000C2 E8(00000000)                call    printb
    63                                  
    64                                      ; clear bit 8
    65 000000C7 48BF-                       mov     rdi, msg6
    65 000000C9 [3C00000000000000] 
    66 000000D1 4831C0                      xor     rax, rax
    67 000000D4 E8(00000000)                call    printf
    68                                  
    69 000000D9 480FBA3425-                 btr     qword [bitflags], 8
    69 000000DE [60000000]08       
    70 000000E3 488B3C25[60000000]          mov     rdi, [bitflags]
    71 000000EB E8(00000000)                call    printb
    72                                  
    73                                      ; test bit 61
    74 000000F0 48BF-                       mov     rdi, msg7
    74 000000F2 [4900000000000000] 
    75 000000FA 4831C0                      xor     rax, rax
    76 000000FD E8(00000000)                call    printf
    77                                  
    78 00000102 4831FF                      xor     rdi, rdi        ; clear rdi
    79 00000105 B83D000000                  mov     rax, 61         ; # bit to be tested -> rax
    80 0000010A 480FA30425-                 bt      [bitflags], rax ; bit test
    80 0000010F [60000000]         
    81 00000113 400F92C7                    setc    dil             ; set dil (low rdi) to 1 if CF is set
    82 00000117 E8(00000000)                call    printb
    83                                          
    84                                  
    85                                  
    86 0000011C C9                          leave
    87 0000011D C3                          ret
